<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Registration</title>
</head>

<body>
    <h1>User Registration</h1>
    <ul id='registration-errors'>

    </ul>
    <form id="registration-form" action="/auth/passport/register" method="POST">
        <!-- First Name -->
        <label for="firstname">First Name:</label>
        <input type="text" id="firstname" name="firstname" required><br>

        <!-- Last Name -->
        <label for="lastname">Last Name:</label>
        <input type="text" id="lastname" name="lastname" required><br>

        <!-- Email -->
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required><br>

        <!-- Password -->
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required><br>
        <label for="password">Verify Password:</label>
        <input type="password" id="verify-password" name="verify-password" required><br>


        <!-- Submit Button -->
        <button type="submit">Register</button>
    </form>
</body>
<script>
    // Assuming you have an element with id "registration-form" for the form
    const registrationForm = document.getElementById("registration-form");
    // let baseUrl = "https://philly-outreach-67a8895e1869.herokuapp.com";
    let baseUrl = "http://localhost:3000";

    //Submit listener
    registrationForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        // Extract form values
        const firstname = document.getElementById("firstname").value;
        const lastname = document.getElementById("lastname").value;
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const verifyPassword = document.getElementById("verify-password").value;

        const errors = document.getElementById("registration-errors");

        // Check if passwords match
        if (password !== verifyPassword) {
            // Display an error message or handle the password mismatch
            console.error("Passwords do not match.");
            const passErr = document.createElement("li");
            passErr.innerHTML = "Passwords do not match"
            errors.appendChild(passErr)
            return;
        }

        // Create a user object with the form data
        const user = {
            firstname,
            lastname,
            email,
            password
        };

        // Send the user object to the server for registration
        const response = await fetch(`${baseUrl}/auth/passport/register`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(user)
        });
        console.log(response, 'raw response')
        console.log(JSON.stringify(response))

        if (response.ok) {
            // Registration was successful
            // You can handle success as needed (e.g., redirect to a login page)
            console.log("Registration successful!");
            errors.innerHTML = 'Registration successful!'

        } else {
            errors.innerHTML = ''
            // Registration failed, handle errors
            const errorData = await response.json();
            console.error("Registration failed:", errorData.errors);
            errorData.errors?.forEach(err => {
                console.log(err);
                const regErr = document.createElement("li");
                regErr.innerHTML = err.msg;
                errors.appendChild(regErr)
            })

        }

    });
</script>

</html>
